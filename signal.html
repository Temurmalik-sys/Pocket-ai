<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pocket Option AI Smart</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  margin:0;
  font-family:Arial;
  background:#020617;
  color:white;
  text-align:center;
}
.container {
  padding:10px;
  max-width:480px;
  margin:auto;
}
select, button {
  font-size:18px;
  padding:8px;
  margin:5px;
  border-radius:8px;
}
#signal {
  font-size:48px;
  margin:10px 0;
}
#price {
  font-size:22px;
}
#chart {
  max-height:200px;
}
.bad {color:#ff4d4d;}
.good {color:#4dff88;}
.wait {color:#ffaa00;}
</style>
</head>
<body>

<div class="container">
<h2>ü§ñ Pocket Option AI Smart</h2>

<select id="asset">
  <option value="EURUSDT">EURUSD</option>
  <option value="GBPUSDT">GBPUSD</option>
  <option value="BTCUSDT">BTC</option>
</select>

<select id="tf">
  <option value="15">15 sec</option>
  <option value="30">30 sec</option>
  <option value="60">1 min</option>
</select>

<div id="price">Loading...</div>
<div id="signal" class="wait">WAIT</div>
<div id="info"></div>

<canvas id="chart"></canvas>

<div style="margin-top:10px;">
<button onclick="addWin()">‚úÖ WIN</button>
<button onclick="addLose()">‚ùå LOSE</button>
</div>

<div id="stats"></div>
</div>

<audio id="sound">
<source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
let prices=[], labels=[];
let win=0, lose=0, lastSignal="WAIT";

const ctx = document.getElementById("chart").getContext("2d");
const chart = new Chart(ctx,{
  type:"line",
  data:{labels:[], datasets:[{data:[], borderWidth:2}]},
  options:{animation:false, plugins:{legend:{display:false}}, scales:{x:{display:false}}}
});

function EMA(p){
  if(prices.length<p) return prices[prices.length-1];
  let k=2/(p+1), ema=prices[0];
  for(let i=1;i<prices.length;i++) ema=prices[i]*k + ema*(1-k);
  return ema;
}

function RSI(p=14){
  if(prices.length<p+1) return 50;
  let g=0,l=0;
  for(let i=prices.length-p;i<prices.length-1;i++){
    let d=prices[i+1]-prices[i];
    if(d>0) g+=d; else l-=d;
  }
  let rs=g/(l||1);
  return 100-(100/(1+rs));
}

// ==== AI MODEL ====
function AI_SCORE(){
  if(prices.length<30) return 0;

  let ema20=EMA(20);
  let ema200=EMA(200);
  let rsi=RSI(14);

  // 1) Trend score
  let trendScore = Math.abs(ema20-ema200) / ema200 * 10000;

  // 2) Volatility score
  let vol=0;
  for(let i=prices.length-10;i<prices.length-1;i++){
    vol += Math.abs(prices[i+1]-prices[i]);
  }
  let volScore = vol * 100000;

  // 3) RSI score
  let rsiScore = 0;
  if(rsi<35 || rsi>65) rsiScore = 20;

  // 4) Micro pattern
  let up=0, down=0;
  for(let i=prices.length-6;i<prices.length-1;i++){
    if(prices[i+1]>prices[i]) up++; else down++;
  }
  let patternScore = Math.max(up,down) * 5;

  return trendScore + volScore + rsiScore + patternScore;
}

function addWin(){ win++; updateStats(); }
function addLose(){ lose++; updateStats(); }

function updateStats(){
  let t=win+lose;
  let wr = t>0 ? ((win/t)*100).toFixed(1) : 0;
  document.getElementById("stats").innerText = `Win: ${win} | Lose: ${lose} | WR: ${wr}%`;
}

async function update(){
  let asset=document.getElementById("asset").value;
  let r=await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${asset}`);
  let data=await r.json();
  let price=parseFloat(data.price);

  prices.push(price);
  if(prices.length>300) prices.shift();
  labels.push("");
  if(labels.length>300) labels.shift();

  chart.data.labels=labels;
  chart.data.datasets[0].data=prices;
  chart.update();

  let ema20=EMA(20);
  let ema200=EMA(200);
  let rsi=RSI(14);

  let trend = price>ema200 ? "UP" : "DOWN";

  let aiScore = AI_SCORE();

  let signal="WAIT";
  let cls="wait";

  if(aiScore > 80){  // AI threshold
    if(trend=="UP" && rsi<45 && price>ema20){
      signal="CALL"; cls="good";
    }
    if(trend=="DOWN" && rsi>55 && price<ema20){
      signal="PUT"; cls="bad";
    }
  }

  if(signal!="WAIT" && signal!=lastSignal){
    document.getElementById("sound").play();
    lastSignal=signal;
  }

  let sigDiv=document.getElementById("signal");
  sigDiv.innerText=signal;
  sigDiv.className=cls;

  document.getElementById("price").innerText = asset+" : "+price;
  document.getElementById("info").innerText = `AI Score: ${aiScore.toFixed(1)} | RSI: ${rsi.toFixed(1)}`;

}

function getInterval(){
  let tf=document.getElementById("tf").value;
  if(tf==15) return 1500;
  if(tf==30) return 3000;
  if(tf==60) return 5000;
}

let timer=setInterval(update, getInterval());
document.getElementById("tf").onchange=()=>{
  clearInterval(timer);
  timer=setInterval(update,getInterval());
}
document.getElementById("asset").onchange=()=>{
  prices=[]; labels=[];
}
</script>

</body>
</html>